langcode: en
status: false
dependencies:
  module:
    - eca
    - markaspot_resubmission
    - node
id: resubmission_reminder_email
label: 'Resubmission Reminder Email'
version: 1.0.0
events:
  send_reminder:
    plugin: 'custom_event:markaspot_resubmission.send_reminder'
    label: 'Resubmission reminder event'
    configuration: {  }
    successors:
      - id: load_node
        condition: ''
conditions: {  }
gateways: {  }
actions:
  load_node:
    plugin: 'eca_content:eca_token_load_entity'
    label: 'Load service request node'
    configuration:
      token_name: service_request
      object: event
      property: node
      from: current
    successors:
      - id: set_recipient
        condition: ''
  set_recipient:
    plugin: 'eca_base:eca_token_set_value'
    label: 'Set recipient email'
    configuration:
      token_name: recipient
      token_value: '[event.recipientEmail]'
    successors:
      - id: prepare_email_body
        condition: ''
  prepare_email_body:
    plugin: 'eca_base:eca_token_set_value'
    label: 'Prepare email body'
    configuration:
      token_name: email_body
      token_value: |
        Guten Tag,

        diese Meldung wurde vor mehr als 6 Wochen in unserem System erfasst und ist noch unbearbeitet:

        Titel: [service_request:title]
        Kategorie: [service_request:field_category:entity:name]
        Status: [service_request:field_status:entity:name]
        Gemeldet am: [service_request:created:medium]
        Letzte Änderung: [service_request:changed:medium]

        Link zur Meldung: [service_request:url]

        Bitte prüfen Sie den Status dieser Meldung und aktualisieren Sie diese entsprechend.

        Mit freundlichen Grüßen
        Ihr Mängelmelder-Team
    successors:
      - id: send_mail_action
        condition: ''
  send_mail_action:
    plugin: 'eca_base:eca_mail'
    label: 'Send reminder email'
    configuration:
      recipient: '[recipient]'
      subject: 'Erinnerung: [service_request:title]'
      message: '[email_body]'
      from: ''
      cc: ''
      bcc: ''
      reply_to: ''
      headers: ''
    successors: {  }
modeller: bpmn_io
